<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <title>–ë–∞—Ä "–•–≤–æ—Å—Ç–∞—Ç—ã–π –ì–ª–æ—Ç–æ–∫" üçª</title>
    <style>
        :root {
            --gold: #ffcc00;
            --wood: #3e2723;
            --dark-bg: #1a0f0a;
            --accent: #5d4037;
        }

        body {
            background-color: var(--dark-bg);
            color: #f3e5ab;
            font-family: 'Noto Color Emoji', 'Segoe UI', serif;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; min-height: 100vh; padding-bottom: 50px;
        }

        .bar-header {
            background: #2d1b0d; width: 100%; text-align: center;
            padding: 20px; border-bottom: 4px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0,0,0,0.8);
            position: sticky; top: 0; z-index: 1000;
        }

        .stats { color: var(--gold); font-weight: bold; font-size: 1.3rem; margin-top: 5px; }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ */
        .game-section {
            margin-top: 30px; background: #2d1b0d;
            padding: 20px; border-radius: 20px;
            border: 3px solid var(--accent);
            text-align: center; width: 350px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        h2 { color: var(--gold); margin-top: 0; font-size: 1.2rem; text-transform: uppercase; }

        /* --- –°–¢–ò–õ–ò –°–¢–ê–ö–ê–ù–ß–ò–ö–û–í --- */
        .cup-stage { height: 120px; position: relative; margin: 20px 0; }
        .cup {
            font-size: 60px; cursor: pointer; position: absolute;
            transition: all 0.25s linear; user-select: none; bottom: 0;
        }
        .pos-0 { left: 10px; } .pos-1 { left: 130px; } .pos-2 { left: 250px; }
        .lifted { transform: translateY(-50px); }

        /* --- –°–¢–ò–õ–ò –ü–û–ö–ï–†–ê --- */
        .dice-area { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .die {
            width: 60px; height: 60px; background: #f3e5ab; color: #1a0f0a;
            display: flex; align-items: center; justify-content: center;
            font-size: 35px; border-radius: 12px; border: 3px solid transparent;
            cursor: pointer; transition: 0.2s; box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }
        .die.keep { border-color: var(--gold); background: #fff5cc; transform: translateY(-5px); box-shadow: 0 5px 15px var(--gold); }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: var(--accent); color: white; border: 2px solid var(--gold);
            padding: 12px 20px; border-radius: 10px; cursor: pointer;
            font-weight: bold; width: 100%; margin-top: 10px;
        }
        .btn:hover { background: var(--gold); color: black; }
        .btn:disabled { opacity: 0.3; }

        #msg-cups, #msg-poker { min-height: 40px; margin-bottom: 10px; font-style: italic; color: var(--gold); }

        .back-link { margin-top: 40px; color: var(--gold); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div class="bar-header">
    <h1>üçª "–•–≤–æ—Å—Ç–∞—Ç—ã–π –ì–ª–æ—Ç–æ–∫"</h1>
    <div class="stats">–¢–≤–æ–π —Å—ã—Ä: <span id="balance">0</span> üßÄ</div>
</div>

<div class="game-section">
    <h2>üçØ –ù–∞–ø—ë—Ä—Å—Ç–∫–∏ (5 üßÄ)</h2>
    <div id="msg-cups">–ë–∞—Ä–º–µ–Ω: "–°–ª–µ–¥–∏ –∑–∞ —Ä—É–∫–∞–º–∏!"</div>
    <div class="cup-stage">
        <div id="cup-0" class="cup pos-0" onclick="guessCup(0)">üçØ</div>
        <div id="cup-1" class="cup pos-1" onclick="guessCup(1)">üçØ</div>
        <div id="cup-2" class="cup pos-2" onclick="guessCup(2)">üçØ</div>
    </div>
    <button id="btn-cups" class="btn" onclick="startCups()">–ò–ì–†–ê–¢–¨ –í –°–¢–ê–ö–ê–ù–´</button>
</div>

<div class="game-section">
    <h2>üé≤ –°—ã—Ä–Ω—ã–π –ü–æ–∫–µ—Ä (10 üßÄ)</h2>
    <div id="msg-poker">–°–æ–±–µ—Ä–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –ª—É—á—à–µ, —á–µ–º —É –±–∞—Ä–º–µ–Ω–∞!</div>
    <div class="dice-area">
        <div class="die" id="d0" onclick="toggleDie(0)">?</div>
        <div class="die" id="d1" onclick="toggleDie(1)">?</div>
        <div class="die" id="d2" onclick="toggleDie(2)">?</div>
    </div>
    <button id="btn-poker" class="btn" onclick="playPoker()">–ë–†–û–°–ò–¢–¨ –ö–û–°–¢–ò</button>
    <p style="font-size: 0.8rem; color: #8d6e63;">–ö–ª–∏–∫–Ω–∏ –Ω–∞ –∫–æ—Å—Ç—å, —á—Ç–æ–±—ã –û–°–¢–ê–í–ò–¢–¨ –µ—ë –ø—Ä–∏ –ø–µ—Ä–µ–±—Ä–æ—Å–µ.</p>
</div>

<a href="https://de6ulu3m-code.github.io/rattown/" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–æ—Ä–æ–¥</a>

<script>
    let cheese = parseInt(localStorage.getItem('ratCheese')) || 0;
    
    // --- –õ–û–ì–ò–ö–ê –û–ë–©–ê–Ø ---
    function updateUI() {
        document.getElementById('balance').innerText = cheese;
        localStorage.setItem('ratCheese', cheese);
    }

    // --- –õ–û–ì–ò–ö–ê –°–¢–ê–ö–ê–ù–ß–ò–ö–û–í ---
    let cupWinning = 0;
    let cupPositions = [0, 1, 2];
    let isCupRunning = false;
    let cupPlayed = false;

    function startCups() {
        if (cheese < 5 || isCupRunning) return;
        cheese -= 5; updateUI();
        isCupRunning = true; cupPlayed = false;
        document.getElementById('btn-cups').disabled = true;

        // –°–±—Ä–æ—Å –∏ –ø–æ–∫–∞–∑
        for(let i=0; i<3; i++) {
            let c = document.getElementById(`cup-${i}`);
            c.classList.remove('lifted');
            c.innerHTML = 'üçØ';
        }

        cupWinning = Math.floor(Math.random() * 3);
        setTimeout(() => {
            const winner = document.getElementById(`cup-${cupWinning}`);
            winner.innerHTML = 'üçØ<br><small>üßÄ</small>';
            winner.classList.add('lifted');
            document.getElementById('msg-cups').innerText = "–ó–∞–ø–æ–º–∏–Ω–∞–π...";

            setTimeout(() => {
                winner.classList.remove('lifted');
                setTimeout(() => {
                    winner.innerHTML = 'üçØ';
                    shuffleCups(0);
                }, 300);
            }, 800);
        }, 200);
    }

    function shuffleCups(count) {
        cupPositions.sort(() => Math.random() - 0.5);
        for(let i=0; i<3; i++) {
            document.getElementById(`cup-${i}`).className = `cup pos-${cupPositions[i]}`;
        }
        if (count < 12) {
            setTimeout(() => shuffleCups(count + 1), 250);
        } else {
            isCupRunning = false;
            document.getElementById('msg-cups').innerText = "–ì–î–ï –°–´–†?";
        }
    }

    function guessCup(id) {
        if (isCupRunning || cupPlayed) return;
        cupPlayed = true;
        document.getElementById('btn-cups').disabled = false;
        
        for(let i=0; i<3; i++) {
            let c = document.getElementById(`cup-${i}`);
            c.classList.add('lifted');
            if (i === cupWinning) c.innerHTML = 'üçØ<br><small>üßÄ</small>';
        }

        if (id === cupWinning) {
            cheese += 15;
            document.getElementById('msg-cups').innerText = "–ü–æ–±–µ–¥–∞! +10 üßÄ";
        } else {
            document.getElementById('msg-cups').innerText = "–ú–∏–º–æ! –ë–∞—Ä–º–µ–Ω –¥–æ–≤–æ–ª–µ–Ω.";
        }
        updateUI();
    }

    // --- –õ–û–ì–ò–ö–ê –ü–û–ö–ï–†–ê ---
    let pokerDice = [0, 0, 0];
    let keepDice = [false, false, false];
    let pokerStep = 0; // 0-–Ω–∞—á–∞–ª–æ, 1-–ø–µ—Ä–µ–±—Ä–æ—Å
    const pokerIcons = ["üßÄ", "üñ±Ô∏è", "üç™", "üçï", "üçû", "ü•ì"];

    function toggleDie(i) {
        if (pokerStep !== 1) return;
        keepDice[i] = !keepDice[i];
        document.getElementById(`d${i}`).classList.toggle('keep', keepDice[i]);
    }

    function playPoker() {
        if (pokerStep === 0) {
            if (cheese < 10) return alert("–ú–∞–ª–æ —Å—ã—Ä–∞!");
            cheese -= 10; updateUI();
            
            // –ü–µ—Ä–≤—ã–π –±—Ä–æ—Å–æ–∫
            rollDice();
            pokerStep = 1;
            document.getElementById('btn-poker').innerText = "–ü–ï–†–ï–ë–†–û–°–ò–¢–¨ –í–´–ë–†–ê–ù–ù–´–ï";
            document.getElementById('msg-poker').innerText = "–í—ã–±–µ—Ä–∏ –∫–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á–µ—à—å –û–°–¢–ê–í–ò–¢–¨.";
        } else {
            // –ü–µ—Ä–µ–±—Ä–æ—Å
            rollDice();
            finishPoker();
        }
    }

    function rollDice() {
        for(let i=0; i<3; i++) {
            if (!keepDice[i]) {
                pokerDice[i] = Math.floor(Math.random() * 6);
                document.getElementById(`d${i}`).innerText = pokerIcons[pokerDice[i]];
            }
        }
    }

    function finishPoker() {
        let botDice = [Math.floor(Math.random()*6), Math.floor(Math.random()*6), Math.floor(Math.random()*6)];
        let pScore = getPokerScore(pokerDice);
        let bScore = getPokerScore(botDice);
        
        let botHand = botDice.map(i => pokerIcons[i]).join(" ");
        let msg = `–£ –±–∞—Ä–º–µ–Ω–∞: ${botHand}. `;

        if (pScore > bScore) {
            cheese += 25; msg += "–¢–´ –í–´–ò–ì–†–ê–õ! +15 –ø—Ä–∏–±—ã–ª–∏.";
        } else if (pScore === bScore) {
            cheese += 10; msg += "–ù–ò–ß–¨–Ø. –°—ã—Ä –≤–æ–∑–≤—Ä–∞—â–µ–Ω.";
        } else {
            msg += "–¢–´ –ü–†–û–ò–ì–†–ê–õ.";
        }

        document.getElementById('msg-poker').innerText = msg;
        document.getElementById('btn-poker').innerText = "–ë–†–û–°–ò–¢–¨ –°–ù–û–í–ê (10 üßÄ)";
        
        // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
        pokerStep = 0;
        keepDice = [false, false, false];
        for(let i=0; i<3; i++) document.getElementById(`d${i}`).classList.remove('keep');
        updateUI();
    }

    function getPokerScore(dice) {
        let counts = {};
        dice.forEach(x => counts[x] = (counts[x] || 0) + 1);
        let vals = Object.values(counts);
        let unique = new Set(dice).size;

        if (Math.max(...vals) === 3) return 4; // –¢—Ä–æ–π–∫–∞ (–°–µ—Ç)
        if (unique === 3) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ç—Ä–∏—Ç (—Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –ø–æ –ø–æ—Ä—è–¥–∫—É)
            let sorted = [...dice].sort();
            if (sorted[2] - sorted[0] === 2) return 3; // –°—Ç—Ä–∏—Ç
            return 1; // –ü—Ä–æ—Å—Ç–æ —Ä–∞–∑–Ω—ã–µ
        }
        if (Math.max(...vals) === 2) return 2; // –ü–∞—Ä–∞
        return 0;
    }

    updateUI();
</script>
</body>
</html>
