<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <title>–ë–∞—Ä "–•–≤–æ—Å—Ç–∞—Ç—ã–π –ì–ª–æ—Ç–æ–∫" üçª</title>
    <style>
        :root {
            --gold: #ffcc00;
            --wood: #3e2723;
            --dark-bg: #1a0f0a;
            --accent: #5d4037;
        }

        body {
            background-color: var(--dark-bg);
            color: #f3e5ab;
            font-family: 'Noto Color Emoji', 'Segoe UI', serif;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; min-height: 100vh; padding-bottom: 50px;
            -webkit-user-select: none; user-select: none;
            touch-action: manipulation;
        }

        /* –≠–ö–†–ê–ù –í–´–®–ò–ë–ê–õ–´ */
        #bouncer-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 9999; display: flex; 
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center; color: var(--gold);
        }

        .bar-header {
            background: #2d1b0d; width: 100%; text-align: center;
            padding: 20px; border-bottom: 4px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0,0,0,0.8);
            position: sticky; top: 0; z-index: 1000;
        }

        .stats { color: var(--gold); font-weight: bold; font-size: 1.3rem; }

        .game-section {
            margin-top: 30px; background: #2d1b0d;
            padding: 20px; border-radius: 20px;
            border: 3px solid var(--accent);
            text-align: center; width: 350px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        /* –°–¢–ê–ö–ê–ù–ò */
        .cup-stage { height: 120px; position: relative; margin: 20px 0; }
        .cup {
            font-size: 60px; cursor: pointer; position: absolute;
            transition: all 0.25s linear; bottom: 0;
        }
        .pos-0 { left: 10px; } .pos-1 { left: 130px; } .pos-2 { left: 250px; }
        .lifted { transform: translateY(-50px); }

        /* –ü–û–ö–ï–† */
        .dice-area { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .die {
            width: 60px; height: 60px; background: #f3e5ab; color: #1a0f0a;
            display: flex; align-items: center; justify-content: center;
            font-size: 35px; border-radius: 12px; border: 3px solid transparent;
            cursor: pointer; transition: 0.2s;
        }
        .die.keep { border-color: var(--gold); transform: translateY(-5px); box-shadow: 0 5px 15px var(--gold); }

        .btn {
            background: var(--accent); color: white; border: 2px solid var(--gold);
            padding: 12px 20px; border-radius: 10px; cursor: pointer;
            font-weight: bold; width: 100%; margin-top: 10px;
        }
        .btn:disabled { opacity: 0.3; }

        .back-link { margin-top: 40px; color: var(--gold); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div id="bouncer-screen">
    <div style="font-size: 80px; margin-bottom: 20px;">üêÄüï∂Ô∏è</div>
    <h2 id="bouncer-text">–°–¢–û–Ø–¢–¨!</h2>
    <p id="bouncer-subtext">–ü–æ–∫–∞–∑—ã–≤–∞–π —Å–≤–æ–∏ –∑–∞–ø–∞—Å—ã.</p>
    <div id="bouncer-action"></div>
    <a href="https://de6ulu3m-code.github.io/ratpage/" style="margin-top: 30px; color: gray; text-decoration: none;">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –¥–≤–æ—Ä–∏–∫</a>
</div>

<div class="bar-header" id="main-header">
    <h1>üçª "–•–≤–æ—Å—Ç–∞—Ç—ã–π –ì–ª–æ—Ç–æ–∫"</h1>
    <div class="stats">–¢–≤–æ–π —Å—ã—Ä: <span id="balance">0</span> üßÄ</div>
</div>

<div class="game-section">
    <h2>üçØ –ù–∞–ø—ë—Ä—Å—Ç–∫–∏ (5 üßÄ)</h2>
    <div id="msg-cups">–°–ª–µ–¥–∏ –∑–∞ —Ä—É–∫–∞–º–∏!</div>
    <div class="cup-stage">
        <div id="cup-0" class="cup pos-0" onclick="guessCup(0)">üçØ</div>
        <div id="cup-1" class="cup pos-1" onclick="guessCup(1)">üçØ</div>
        <div id="cup-2" class="cup pos-2" onclick="guessCup(2)">üçØ</div>
    </div>
    <button id="btn-cups" class="btn" onclick="startCups()">–ò–ì–†–ê–¢–¨</button>
</div>

<div class="game-section">
    <h2>üé≤ –°—ã—Ä–Ω—ã–π –ü–æ–∫–µ—Ä (10 üßÄ)</h2>
    <div id="msg-poker">–ë–ª–µ—Ñ—É–π –∏–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–µ—à—å!</div>
    <div class="dice-area">
        <div class="die" id="d0" onclick="toggleDie(0)">?</div>
        <div class="die" id="d1" onclick="toggleDie(1)">?</div>
        <div class="die" id="d2" onclick="toggleDie(2)">?</div>
    </div>
    <button id="btn-poker" class="btn" onclick="playPoker()">–ë–†–û–°–ò–¢–¨ –ö–û–°–¢–ò</button>
</div>

<a href="https://de6ulu3m-code.github.io/ratpage/" class="back-link">‚Üê –£–π—Ç–∏ –∏–∑ –±–∞—Ä–∞</a>

<script>
    let cheese = parseInt(localStorage.getItem('ratCheese')) || 0;

    // --- –õ–û–ì–ò–ö–ê –í–´–®–ò–ë–ê–õ–´ ---
    function checkBouncer() {
    const screen = document.getElementById('bouncer-screen');
    const text = document.getElementById('bouncer-text');
    const subtext = document.getElementById('bouncer-subtext');
    const action = document.getElementById('bouncer-action');
    
    // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –æ–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é cheese –∏–∑ –ø–∞–º—è—Ç–∏ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π
    cheese = parseInt(localStorage.getItem('ratCheese')) || 0;
    
    const wasKicked = sessionStorage.getItem('kickedOut');

    // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–ª–∞–≥ –∏–∑–≥–Ω–∞–Ω–∏—è, –Ω–æ —Å—ã—Ä–∞ —É–∂–µ –º–Ω–æ–≥–æ ‚Äî –¥–∞–µ–º —à–∞–Ω—Å –≤–æ–π—Ç–∏
    if (wasKicked && cheese < 50) {
        text.innerText = "–ü–û–®–ï–õ –í–û–ù!";
        text.style.color = "#ff4444";
        subtext.innerHTML = `<b style='color:white;'>–¢–µ–±—è –≤—ã–≥–Ω–∞–ª–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —É —Ç–µ–±—è –º–∞–ª–æ —Å—ã—Ä–∞ (${cheese})!</b><br>–ù–∞–∫–æ–ø–∏ 50 üßÄ –≤ –≥–æ—Ä–æ–¥–µ.`;
        action.innerHTML = `<button class="btn" onclick="location.href='https://de6ulu3m-code.github.io/ratpage/'">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –¥–≤–æ—Ä–∏–∫</button>`;
        return;
    }

    // –ï—Å–ª–∏ —Å—ã—Ä–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Äî —É–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    if (cheese >= 50) {
        sessionStorage.removeItem('kickedOut'); // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —á–∏—Å—Ç–∏–º —Ñ–ª–∞–≥ –∏–∑–≥–Ω–∞–Ω–∏—è
        text.innerText = cheese >= 500 ? "–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨, –ë–û–°–°!" : "–•–º... –ü—Ä–æ—Ö–æ–¥–∏.";
        text.style.color = "var(--gold)";
        subtext.innerText = `–£ —Ç–µ–±—è ${cheese} üßÄ. –í–∏–¥ —Å–æ–ª–∏–¥–Ω—ã–π.`;
        action.innerHTML = `<button class="btn" onclick="letIn()" style="padding: 15px 40px;">–í–û–ô–¢–ò –í –ë–ê–†</button>`;
    } else {
        text.innerText = "–í–•–û–î –í–û–°–ü–†–ï–©–ï–ù!";
        text.style.color = "red";
        subtext.innerHTML = `–£ —Ç–µ–±—è –≤—Å–µ–≥–æ ${cheese} üßÄ.<br>–í—Ö–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–ª–∏–¥–Ω—ã—Ö –∫—Ä—ã—Å (–æ—Ç 50 üßÄ).`;
        action.innerHTML = `<button class="btn" onclick="location.href='https://de6ulu3m-code.github.io/ratpage/'">–£–ô–¢–ò</button>`;
    }
    }

    function letIn() {
        const screen = document.getElementById('bouncer-screen');
        screen.style.transition = "opacity 0.5s ease";
        screen.style.opacity = "0";
        setTimeout(() => screen.style.display = "none", 500);
    }

    function kickOut() {
        sessionStorage.setItem('kickedOut', 'true');
        const screen = document.getElementById('bouncer-screen');
        screen.style.display = "flex";
        screen.style.opacity = "1";
        checkBouncer();
    }

    function updateUI() {
        document.getElementById('balance').innerText = cheese;
        localStorage.setItem('ratCheese', cheese);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–ª–µ—Ç, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç–∫—Ä–∞–Ω –≤—ã—à–∏–±–∞–ª—ã —Å–∫—Ä—ã—Ç
        const bouncerScreen = document.getElementById('bouncer-screen');
        if (cheese < 35 && bouncerScreen.style.display === 'none') {
            kickOut();
        }
    }

    // --- –°–¢–ê–ö–ê–ù–ß–ò–ö–ò ---
    let cupWinning = 0, cupPositions = [0, 1, 2], isCupRunning = false, cupPlayed = false;

    function startCups() {
        if (cheese < 5 || isCupRunning) return;
        
        // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
        for(let i=0; i<3; i++) {
            let c = document.getElementById(`cup-${i}`);
            c.classList.remove('lifted'); 
            c.innerHTML = 'üçØ';
        }

        setTimeout(() => {
            cheese -= 5; updateUI();
            isCupRunning = true; cupPlayed = false;
            document.getElementById('btn-cups').disabled = true;

            cupWinning = Math.floor(Math.random() * 3);
            const winner = document.getElementById(`cup-${cupWinning}`);
            winner.innerHTML = 'üçØ<br><small>üßÄ</small>';
            winner.classList.add('lifted');
            
            setTimeout(() => {
                winner.classList.remove('lifted');
                setTimeout(() => { winner.innerHTML = 'üçØ'; shuffleCups(0); }, 300);
            }, 800);
        }, 300);
    }

    function shuffleCups(count) {
        cupPositions.sort(() => Math.random() - 0.5);
        for(let i=0; i<3; i++) document.getElementById(`cup-${i}`).className = `cup pos-${cupPositions[i]}`;
        if (count < 12) setTimeout(() => shuffleCups(count + 1), 250);
        else { isCupRunning = false; document.getElementById('msg-cups').innerText = "–ì–î–ï –°–´–†?"; }
    }

    function guessCup(id) {
        if (isCupRunning || cupPlayed) return;
        cupPlayed = true; document.getElementById('btn-cups').disabled = false;
        for(let i=0; i<3; i++) {
            let c = document.getElementById(`cup-${i}`);
            c.classList.add('lifted');
            if (i === cupWinning) c.innerHTML = 'üçØ<br><small>üßÄ</small>';
        }
        if (id === cupWinning) { cheese += 15; document.getElementById('msg-cups').innerText = "–ü–æ–±–µ–¥–∞! +10 üßÄ"; }
        else { document.getElementById('msg-cups').innerText = "–ú–∏–º–æ!"; }
        updateUI();
    }

    // --- –ü–û–ö–ï–† ---
    let pokerDice = [0,0,0], keepDice = [false,false,false], pokerStep = 0;
    const icons = ["üßÄ", "üñ±Ô∏è", "üç™", "üçï", "üçû", "ü•ì"];

    function toggleDie(i) { if (pokerStep === 1) { keepDice[i] = !keepDice[i]; document.getElementById(`d${i}`).classList.toggle('keep'); } }

    function playPoker() {
        if (pokerStep === 0) {
            if (cheese < 10) return alert("–ù—É–∂–Ω–æ 10 üßÄ!");
            cheese -= 10; updateUI();
            roll(); pokerStep = 1;
            document.getElementById('btn-poker').innerText = "–ü–ï–†–ï–ë–†–û–°–ò–¢–¨";
        } else { roll(); finishPoker(); }
    }

    function roll() {
        for(let i=0; i<3; i++) if (!keepDice[i]) { pokerDice[i] = Math.floor(Math.random()*6); document.getElementById(`d${i}`).innerText = icons[pokerDice[i]]; }
    }

    function finishPoker() {
        let bot = [Math.floor(Math.random()*6), Math.floor(Math.random()*6), Math.floor(Math.random()*6)];
        let pS = getScore(pokerDice), bS = getScore(bot);
        let res = `–ë–∞—Ä–º–µ–Ω: ${bot.map(i=>icons[i]).join(" ")}. `;
        if (pS > bS) { cheese += 25; res += "–í–ò–ù! +15 üßÄ"; }
        else if (pS === bS) { cheese += 10; res += "–ù–ò–ß–¨–Ø."; }
        else res += "–õ–û–°–°.";
        document.getElementById('msg-poker').innerText = res;
        pokerStep = 0; keepDice = [false,false,false];
        for(let i=0; i<3; i++) document.getElementById(`d${i}`).classList.remove('keep');
        document.getElementById('btn-poker').innerText = "–ò–ì–†–ê–¢–¨ (10 üßÄ)";
        updateUI();
    }

    function getScore(d) {
        let counts = {}; d.forEach(x => counts[x] = (counts[x]||0)+1);
        let v = Object.values(counts), max = Math.max(...v);
        if (max === 3) return 4;
        let sorted = [...d].sort(); if (new Set(d).size === 3 && (sorted[2]-sorted[0] === 2)) return 3;
        if (max === 2) return 2;
        return 1;
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    checkBouncer();
    updateUI();
</script>
</body>
</html>
