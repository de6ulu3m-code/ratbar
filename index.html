<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <title>–ë–∞—Ä "–•–≤–æ—Å—Ç–∞—Ç—ã–π –ì–ª–æ—Ç–æ–∫" üçª</title>
    <style>
        :root {
            --gold: #ffcc00;
            --wood: #3e2723;
            --dark-wood: #1a0f0a;
        }

        body {
            background-color: var(--dark-wood);
            color: #f3e5ab;
            font-family: 'Noto Color Emoji', 'Segoe UI', serif;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; min-height: 100vh; overflow-x: hidden;
        }

        /* –®–∞–ø–∫–∞ –±–∞—Ä–∞ */
        .bar-header {
            background: #2d1b0d; width: 100%; text-align: center;
            padding: 20px; border-bottom: 4px solid #5d4037;
            box-shadow: 0 5px 15px rgba(0,0,0,0.8);
        }

        .stats { color: var(--gold); font-weight: bold; font-size: 1.3rem; margin-top: 10px; }

        /* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
        .game-container {
            margin-top: 40px;
            background: #2d1b0d;
            padding: 30px;
            border-radius: 30px;
            border: 3px solid #5d4037;
            text-align: center;
            width: 350px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
        }

        #msg { 
            height: 50px; margin-bottom: 20px; 
            font-style: italic; color: var(--gold);
            font-size: 1.1rem;
        }

        .cup-stage {
            height: 150px;
            position: relative;
            margin-bottom: 20px;
            /* –ß—Ç–æ–±—ã —Å—Ç–∞–∫–∞–Ω—ã –Ω–µ –≤—ã–ª–µ—Ç–∞–ª–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã */
        }

        .cup {
            font-size: 65px;
            cursor: pointer;
            position: absolute;
            transition: all 0.4s cubic-bezier(0.45, 0.05, 0.55, 0.95);
            user-select: none;
            bottom: 10px;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
        }

        /* –ü–æ–∑–∏—Ü–∏–∏ —Å—Ç–∞–∫–∞–Ω–æ–≤ */
        .pos-0 { left: 10px; }
        .pos-1 { left: 135px; }
        .pos-2 { left: 260px; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—ä–µ–º–∞ */
        .lifted { transform: translateY(-60px); }

        .btn {
            background: #5d4037; color: white; border: 2px solid var(--gold);
            padding: 15px 30px; border-radius: 12px; cursor: pointer;
            font-weight: bold; font-size: 1rem; transition: 0.2s;
        }
        .btn:hover { background: var(--gold); color: black; }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; }

        .back-link {
            margin-top: auto; padding: 30px;
            color: var(--gold); text-decoration: none; font-weight: bold;
        }
    </style>
</head>
<body>

<div class="bar-header">
    <h1>üçª –ë–∞—Ä "–•–≤–æ—Å—Ç–∞—Ç—ã–π –ì–ª–æ—Ç–æ–∫"</h1>
    <div class="stats">–¢–≤–æ–π —Å—ã—Ä: <span id="balance">0</span> üßÄ</div>
</div>

<div class="game-container">
    <div id="msg">–≠–π, –∫—Ä—ã—Å–∞! –•–æ—á–µ—à—å –ø–æ–¥–∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å —Å—ã—Ä–∞?</div>
    
    <div class="cup-stage" id="stage">
        <div id="cup-0" class="cup pos-0" onclick="playerGuess(0)">üçØ</div>
        <div id="cup-1" class="cup pos-1" onclick="playerGuess(1)">üçØ</div>
        <div id="cup-2" class="cup pos-2" onclick="playerGuess(2)">üçØ</div>
    </div>

    <button id="start-btn" class="btn" onclick="startGame()">–ò–ì–†–ê–¢–¨ (5 üßÄ)</button>
</div>

<div id="dialog-area" style="margin-top: 20px; max-width: 300px; text-align: center; color: #8d6e63;">
    <p><i>–í —É–≥–ª—É –∏–≥—Ä–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –ø–∞—Ç–µ—Ñ–æ–Ω, –ø–∞—Ö–Ω–µ—Ç –ø—ã–ª—å—é –∏ –¥–æ—Ä–æ–≥–∏–º —à–≤–µ–π—Ü–∞—Ä—Å–∫–∏–º —Å—ã—Ä–æ–º...</i></p>
</div>

<a href="https://de6ulu3m-code.github.io/rattown/" class="back-link">‚Üê –£–π—Ç–∏ –∏–∑ –±–∞—Ä–∞</a>

<script>
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    let cheese = parseInt(localStorage.getItem('ratCheese')) || 0;
    let winningCup = 0;
    let currentPositions = [0, 1, 2]; 
    let isShuffling = false;
    let hasPlayed = false;

    function updateUI() {
        document.getElementById('balance').innerText = cheese;
        localStorage.setItem('ratCheese', cheese);
    }

    function startGame() {
    if (cheese < 5) {
        document.getElementById('msg').innerText = "–ë–∞—Ä–º–µ–Ω: –£ —Ç–µ–±—è –Ω–µ—Ç –¥–µ–Ω–µ–≥ –¥–∞–∂–µ –Ω–∞ –∫–æ—Ä–æ—á–∫—É!";
        return;
    }
    if (isShuffling) return;

    // --- –í–û–¢ –≠–¢–û–¢ –ë–õ–û–ö –ù–£–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨/–û–ë–ù–û–í–ò–¢–¨ ---
    // –û–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Å—Ç–∞–∫–∞–Ω—ã –∏ –æ—á–∏—â–∞–µ–º –∏—Ö –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ —Å—ã—Ä–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
    for (let i = 0; i < 3; i++) {
        const cup = document.getElementById(`cup-${i}`);
        cup.classList.remove('lifted'); // –û–ø—É—Å–∫–∞–µ–º
        cup.innerHTML = 'üçØ';           // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–π —Å—ã—Ä
    }
    // ------------------------------------------

    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã —Å—Ç–∞–∫–∞–Ω—ã —É—Å–ø–µ–ª–∏ –æ–ø—É—Å—Ç–∏—Ç—å—Å—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ø–æ–∫–∞–∂–µ—Ç—Å—è –Ω–æ–≤—ã–π —Å—ã—Ä
    setTimeout(() => {
        // –°—Ç–∞–≤–∫–∞
        cheese -= 5;
        updateUI();
        
        isShuffling = true;
        hasPlayed = false;
        document.getElementById('start-btn').disabled = true;

        // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—ã—Ä
        winningCup = Math.floor(Math.random() * 3);
        const winner = document.getElementById(`cup-${winningCup}`);
        
        document.getElementById('msg').innerText = "–°–º–æ—Ç—Ä–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ...";
        winner.innerHTML = 'üçØ<br><span style="font-size:30px">üßÄ</span>';
        winner.classList.add('lifted');

        // 2. –ü—Ä—è—á–µ–º –∏ –∫—Ä—É—Ç–∏–º
        setTimeout(() => {
            winner.classList.remove('lifted');
            setTimeout(() => {
                winner.innerHTML = 'üçØ';
                startShuffling();
            }, 400);
        }, 1000);
    }, 300); // –ü–∞—É–∑–∞ –Ω–∞ "–ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏–µ"
    }

    function startShuffling() {
        let count = 0;
        const maxShuffles = 10; // –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏
        
        const shuffleInterval = setInterval(() => {
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏
            currentPositions.sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < 3; i++) {
                const cup = document.getElementById(`cup-${i}`);
                cup.className = `cup pos-${currentPositions[i]}`;
            }
            
            count++;
            if (count >= maxShuffles) {
                clearInterval(shuffleInterval);
                isShuffling = false;
                document.getElementById('msg').innerText = "–ì–î–ï –°–´–†?";
            }
        }, 150); // –°–∫–æ—Ä–æ—Å—Ç—å –∫—Ä—É–∂–µ–Ω–∏—è
    }

    function playerGuess(cupId) {
        if (isShuffling || hasPlayed) return;

        hasPlayed = true;
        document.getElementById('start-btn').disabled = false;
        document.getElementById('start-btn').innerText = "–ï–©–Å –†–ê–ó?";

        // –í—Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç—ã
        for (let i = 0; i < 3; i++) {
            const cup = document.getElementById(`cup-${i}`);
            cup.classList.add('lifted');
            if (i === winningCup) {
                cup.innerHTML = 'üçØ<br><span style="font-size:30px">üßÄ</span>';
            }
        }

        if (cupId === winningCup) {
            cheese += 15;
            document.getElementById('msg').innerText = "–ß–ï–†–¢! –¢–≤–æ—è –≤–∑—è–ª–∞. –ó–∞–±–∏—Ä–∞–π —Å—ã—Ä.";
        } else {
            document.getElementById('msg').innerText = "–•–ê! –°—ã—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –±–∞—Ä–µ.";
        }
        updateUI();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞
    updateUI();
</script>

</body>
</html>
